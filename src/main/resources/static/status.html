<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Parkoló állapota</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
            padding: 2rem;
            max-width: 700px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
        }

        .spot {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .occupied {
            border-left: 5px solid #e74c3c;
            background-color: #ffeeee;
        }

        .free {
            border-left: 5px solid #2ecc71;
            background-color: #eeffee;
        }

        .spot-number {
            font-weight: bold;
            margin-right: 1rem;
            min-width: 80px;
        }

        .spot-info {
            flex-grow: 1;
        }

        .car-details {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #555;
        }

        .back-button {
            text-align: center;
            margin-top: 2rem;
        }

        .back-button button {
            padding: 0.7rem 1.2rem;
            background-color: #007bff;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-button button:hover {
            background-color: #0056b3;
        }

        .error {
            color: #e74c3c;
            text-align: center;
            padding: 1rem;
            background-color: #ffeeee;
            border-radius: 8px;
        }

        .free-spot {
            color: #2ecc71;
            font-weight: bold;
        }

        .occupied-spot {
            color: #e74c3c;
            font-weight: bold;
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .refresh-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
<h1>Parkolóhelyek állapota (1-20)</h1>
<div id="last-updated" class="last-updated">
    Utoljára frissítve: <span id="update-time"></span>
    <button class="refresh-btn" onclick="forceRefresh()">⟳ Kényszerített frissítés</button>
</div>
<div id="status-list"></div>

<div class="back-button">
    <button onclick="window.location.href='index.html'">⬅️ Vissza a főoldalra</button>
</div>

<script>
    // Cache megakadályozása
    const cacheBuster = () => `?_=${new Date().getTime()}`;

    document.addEventListener('DOMContentLoaded', function() {
        loadParkingSpots();

        // Automatikus frissítés 5 másodpercenként
        setInterval(loadParkingSpots, 5000);
    });

    function forceRefresh() {
        console.log("Kényszerített frissítés...");
        loadParkingSpots();
    }

function loadParkingSpots() {
    fetch(`/api/spots${cacheBuster()}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Hálózati hiba történt');
            }
            return response.json();
        })
        .then(spots => {
            updateLastUpdatedTime();
            const list = document.getElementById('status-list');
            list.innerHTML = '';

            // Ha nincsenek adatok, jelenítsünk meg üres állapotot
            if (!spots || spots.length === 0) {
                list.innerHTML = '<div class="error">Nincsenek parkolóhely adatok</div>';
                return;
            }

            // 1-20-ig generáljuk a parkolóhelyeket
            for (let i = 1; i <= 20; i++) {
                const spot = spots.find(s => s.spotNumber === i);
                const div = document.createElement('div');
                div.className = 'spot';

                if (spot && spot.occupied) {
                    div.classList.add('occupied');
                    div.innerHTML = `
                        <span class="spot-number">${i}. hely</span>
                        <span class="spot-info">
                            <span class="occupied-spot">FOGLALT</span>
                            <div class="car-details">
                                Rendszám: <strong>${spot.licensePlate || 'Nincs megadva'}</strong><br>
                                Típus: ${spot.carType || 'Nincs megadva'}<br>
                                Szín: ${spot.color || 'Nincs megadva'}
                            </div>
                        </span>
                    `;
                } else {
                    div.classList.add('free');
                    div.innerHTML = `
                        <span class="spot-number">${i}. hely</span>
                        <span class="spot-info">
                            <span class="free-spot">SZABAD</span>
                        </span>
                    `;
                }

                list.appendChild(div);
            }
        })
        .catch(error => {
            console.error('Hiba a parkolóállapot lekérdezésekor:', error);
            document.getElementById('status-list').innerHTML = `
                <div class="error">Hiba történt az adatok betöltése közben: ${error.message}</div>
            `;
        });
}

    function updateLastUpdatedTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('hu-HU');
        document.getElementById('update-time').textContent = timeString;
    }
</script>
</body>
</html>